<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect - Enviar Solicitud</title>
    <link href="../vistas/CSS/estiloenviar_Solitud.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

</head>
<body>
    <!-- Men√∫ lateral -->
    <nav class="sidebar">
        <div class="logo">
            <a href="index.html">
                <img src="../vistas/SRC/logo.png" alt="Campus Connect">
            </a>
        </div>
        
        <ul class="menu">
            <li><a href="/campus_connect/vistas/index.html"><i class="fas fa-home"></i>Inicio</a></li>
            <li><a href="" class="active"><i class="fas fa-paper-plane"></i>Enviar Solicitud</a></li>
            <li><a href="/campus_connect/vistas/estado_solicitud.html"><i class="fas fa-clipboard-check"></i>Estado de mi Solicitud</a></li>
            <li><a href="/campus_connect/vistas/calendario.html"><i class="fas fa-calendar-alt"></i>Calendario Acad√©mico</a></li>
            <li><a href="/campus_connect/vistas/directorio.html"><i class="fas fa-map-marker-alt"></i>Mapa y Directorio</a></li>
            <li><a href="/campus_connect/vistas/ayuda.html"><i class="fas fa-comments"></i>Ayuda</a></li>
        </ul>
        
        <button class="admin-button" onclick="location.href='iniciosesion.html'">
            <i class="fas fa-user-shield"></i> Administrador
          </button>
          
        
        <!-- Logo de la Universidad de Medell√≠n -->
        <div class="udem-logo">
            <img src="../vistas/SRC/universidad.jpg" alt="Universidad de Medell√≠n">
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="main-content">
        <div class="calendar-header">
            <span class="university-badge">
                <i class="fas fa-university"></i> Universidad de Medell√≠n
            </span>
        <div class="form-header">
            <h1><i class="fas fa-paper-plane"></i> Enviar Solicitud</h1>
            <p>Complete el siguiente formulario para enviar su solicitud</p>
        </div>

        <div class="form-steps">
            <div class="step-line"></div>
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div>Usuario y Solicitud</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div>Informaci√≥n</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div>Documentos</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div>Confirmaci√≥n</div>
            </div>
        </div>

        <div class="form-content">
            <!-- Paso 1: Selecci√≥n de tipo de usuario y solicitud combinados -->
            <div class="form-section active" id="section1">
                <div class="user-request-container">
                    <div>
                        <div class="form-group">
                            <label for="user-type">Seleccione su tipo de usuario:</label>
                            <select id="user-type" class="form-control">
                                <option value="">-- Seleccione --</option>
                                <option value="student">Estudiante</option>
                                <option value="applicant">Aspirante</option>
                                <option value="professor">Profesor</option>
                                <option value="administrative">Administrativo</option>
                                <option value="graduate">Egresado</option>
                                <option value="contractor">Contratista</option>
                                <option value="external">Persona externa</option>
                            </select>
                        </div>

                        <!-- Campos adicionales para administrativos -->
                        <div id="administrative-fields" style="display: none;">
                            <div class="form-group">
                                <label for="area">Nombre del √°rea o dependencia:</label>
                                <input type="text" id="area" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="faculty">Facultad o unidad:</label>
                                <input type="text" id="faculty" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label for="request-type">Tipo de solicitud:</label>
                            <select id="request-type" class="form-control" disabled>
                                <option value="">-- Seleccione primero su tipo de usuario --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <div></div>
                    <button class="btn btn-primary" onclick="nextStep(1, 2)">Siguiente</button>
                </div>
            </div>

            <!-- Paso 2: Informaci√≥n del solicitante -->
            <div class="form-section" id="section2">
                <h3>Informaci√≥n del solicitante</h3>
                
                <div class="form-group">
                    <label for="fullname">Nombre completo:</label>
                    <input type="text" id="fullname" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="id-type">Tipo de documento:</label>
                    <select id="id-type" class="form-control" required>
                        <option value="">-- Seleccione --</option>
                        <option value="cc">C√©dula de ciudadan√≠a</option>
                        <option value="ce">C√©dula de extranjer√≠a</option>
                        <option value="ti">Tarjeta de identidad</option>
                        <option value="passport">Pasaporte</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="id-number">N√∫mero de documento:</label>
                    <input type="text" id="id-number" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Correo electr√≥nico:</label>
                    <input type="email" id="email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Tel√©fono de contacto:</label>
                    <input type="tel" id="phone" class="form-control" required>
                </div>
                
                <!-- Campos espec√≠ficos seg√∫n tipo de solicitud -->
                <div id="dynamic-fields">
                    <!-- Se llenar√° din√°micamente seg√∫n el tipo de solicitud -->
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="prevStep(2, 1)">Anterior</button>
                    <button class="btn btn-primary" onclick="nextStep(2, 3)">Siguiente</button>
                </div>
            </div>

            <!-- Paso 3: Adjuntar documentos -->
            <div class="form-section" id="section3">
                <h3>Adjuntar documentos</h3>
                <p>Suba los documentos requeridos para su solicitud (PDF, JPG, PNG)</p>
                
                <div class="file-upload">
                    <input type="file" id="file-input" multiple>
                    <label for="file-input" class="file-upload-label">
                        <i class="fas fa-cloud-upload-alt"></i> Arrastre archivos aqu√≠ o haga clic para seleccionar
                    </label>
                </div>

                <div class="file-list" id="file-list">
            
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="prevStep(3, 2)">Anterior</button>
                    <button class="btn btn-primary" onclick="nextStep(3, 4)">Siguiente</button>
                </div>
            </div>

            <!-- Paso 4: Confirmaci√≥n -->
            <div class="form-section" id="section4">
                <div class="confirmation">
                    <div class="confirmation-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>¬°Solicitud lista para enviar!</h2>
                    <p>Revise los detalles de su solicitud antes de enviar</p>
                    
                    <div id="summary-content" style="text-align: left; background: #f5f5f5; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="prevStep(4, 3)">Anterior</button>
                        <button class="btn btn-primary" onclick="submitRequest()">Enviar Solicitud</button>
                    </div>
                </div>
            </div>

            <!-- Paso 5: Comprobante (se muestra despu√©s de enviar) -->
            <div class="form-section" id="section5">
                <div class="confirmation">
                    <div class="confirmation-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>¬°Solicitud enviada con √©xito!</h2>
                    <p>Hemos recibido su solicitud correctamente</p>
                    
                    <div class="ticket-number" id="ticket-number">
                        N√∫mero de ticket: CC-2023-0001
                    </div>

                    <p>Hemos enviado un correo electr√≥nico con los detalles de su solicitud.</p>
                    <p>Puede consultar el estado de su solicitud en cualquier momento.</p>

                    <button class="btn btn-primary" onclick="resetAndGoHome()">
                        <i class="fas fa-home"></i> Volver al inicio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos de los tipos de solicitud por usuario
        const requestTypes = {
            student: [
                "Certificados (matr√≠cula, notas, paz y salvo, etc.)",
                "Asesor√≠a acad√©mica",
                "Problemas con plataforma virtual o correo",
                "Solicitud de cambio de grupo o materia",
                "Petici√≥n, queja, reclamo o sugerencia (PQRS)",
                "Solicitud de extensi√≥n, cursos u horarios especiales",
                "Pr√©stamo de espacios o recursos (salones, laboratorios)",
                "Apoyo psicol√≥gico o bienestar universitario",
                "Solicitud de beca o ayuda econ√≥mica",
                "Otra"
            ],
            applicant: [
                "Informaci√≥n sobre programas acad√©micos",
                "Solicitud de admisi√≥n",
                "Requisitos de inscripci√≥n",
                "Agendamiento de cita o visita al campus",
                "Problemas con el formulario de inscripci√≥n en l√≠nea",
                "Consulta sobre costos y formas de pago",
                "Otra"
            ],
            professor: [
                "Solicitud de soporte en plataforma o correo institucional",
                "Reporte de fallas t√©cnicas en sal√≥n o laboratorio",
                "Solicitud de materiales o recursos did√°cticos",
                "Solicitud de capacitaci√≥n TIC",
                "Petici√≥n de cambio de horario o grupo",
                "PQRS",
                "Otra"
            ],
            administrative: [
                "Solicitud de mantenimiento (infraestructura, tecnolog√≠a, limpieza)",
                "Soporte t√©cnico",
                "Solicitud de dotaci√≥n o insumos",
                "Solicitud de personal o apoyo operativo",
                "Consulta de procesos administrativos",
                "PQRS",
                "Otra"
            ],
            graduate: [
                "Solicitud de certificado",
                "Actualizaci√≥n de datos",
                "Solicitud de homologaci√≥n para nuevo programa",
                "Apoyo para empleo o bolsa laboral",
                "Consulta sobre eventos o beneficios para egresados",
                "PQRS",
                "Otra"
            ],
            contractor: [
                "Solicitud de acceso a instalaciones",
                "Reporte de novedades en ejecuci√≥n de contrato",
                "Solicitud de documentos o constancias",
                "PQRS",
                "Otra"
            ],
            external: [
                "Solicitud de informaci√≥n general",
                "Pr√©stamo/alquiler de espacios",
                "Solicitud de servicios institucionales",
                "PQRS",
                "Otra"
            ]
        };

        // Campos espec√≠ficos por tipo de solicitud
        const requestFields = {
            // Certificados (Estudiante)
            "Certificados (matr√≠cula, notas, paz y salvo, etc.)": [
                { type: "select", name: "certificate_type", label: "Tipo de certificado", options: ["Certificado de matr√≠cula", "Certificado de notas", "Paz y salvo", "Constancia de estudio", "Otro"], required: true },
                { type: "text", name: "program", label: "Programa acad√©mico", required: true },
                { type: "text", name: "semester", label: "Semestre o periodo acad√©mico", required: true },
                { type: "select", name: "delivery_type", label: "Forma de entrega", options: ["Digital", "F√≠sica"], required: true }
            ],
            // PQRS (com√∫n a varios)
            "Petici√≥n, queja, reclamo o sugerencia (PQRS)": [
                { type: "select", name: "pqrs_type", label: "Tipo de PQRS", options: ["Petici√≥n", "Queja", "Reclamo", "Sugerencia"], required: true },
                { type: "textarea", name: "description", label: "Descripci√≥n detallada", required: true },
                { type: "text", name: "location", label: "Ubicaci√≥n o √°rea relacionada (si aplica)", required: false }
            ],
            // Solicitud de espacios
            "Pr√©stamo de espacios o recursos (salones, laboratorios)": [
                { type: "select", name: "space_type", label: "Tipo de espacio", options: ["Sal√≥n de clase", "Laboratorio", "Sala de estudio", "Auditorio", "Otro"], required: true },
                { type: "date", name: "date", label: "Fecha solicitada", required: true },
                { type: "time", name: "start_time", label: "Hora de inicio", required: true },
                { type: "time", name: "end_time", label: "Hora de finalizaci√≥n", required: true },
                { type: "number", name: "attendees", label: "N√∫mero aproximado de personas", required: true },
                { type: "textarea", name: "purpose", label: "Prop√≥sito del uso", required: true }
            ],
            // Solicitud de informaci√≥n (Aspirante)
            "Informaci√≥n sobre programas acad√©micos": [
                { type: "select", name: "program_type", label: "Nivel de formaci√≥n", options: ["Pregrado", "Posgrado", "Diplomado", "Curso de extensi√≥n"], required: true },
                { type: "select", name: "modality", label: "Modalidad", options: ["Presencial", "Virtual", "H√≠brida"], required: true },
                { type: "text", name: "program_interest", label: "Programa de inter√©s (si aplica)", required: false }
            ],
            // Otras solicitudes gen√©ricas
            "Otra": [
                { type: "textarea", name: "description", label: "Descripci√≥n detallada de su solicitud", required: true }
            ]
            // Se pueden agregar m√°s campos espec√≠ficos para cada tipo de solicitud
        };

        // Variables para almacenar los datos del formulario
        let formData = {
            userType: "",
            requestType: "",
            administrativeInfo: {},
            personalInfo: {},
            requestDetails: {},
            documents: []
        };

        // Evento cuando cambia el tipo de usuario
        document.getElementById('user-type').addEventListener('change', function() {
            const userType = this.value;
            const requestTypeSelect = document.getElementById('request-type');
            
            if (userType) {
                // Habilitar y actualizar el selector de tipo de solicitud
                requestTypeSelect.disabled = false;
                requestTypeSelect.innerHTML = '<option value="">-- Seleccione tipo de solicitud --</option>';
                
                // Agregar opciones seg√∫n el tipo de usuario
                requestTypes[userType].forEach(request => {
                    requestTypeSelect.innerHTML += `<option value="${request}">${request}</option>`;
                });
                
                // Mostrar campos adicionales para administrativos
                if (userType === 'administrative') {
                    document.getElementById('administrative-fields').style.display = 'block';
                } else {
                    document.getElementById('administrative-fields').style.display = 'none';
                }
                
                formData.userType = userType;
            } else {
                requestTypeSelect.disabled = true;
                requestTypeSelect.innerHTML = '<option value="">-- Seleccione primero su tipo de usuario --</option>';
            }
        });

        // Manejo de pasos del formulario
        function goToStep(step) {
            // Ocultar todas las secciones
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la secci√≥n actual
            document.getElementById(`section${step}`).classList.add('active');
            
            // Actualizar pasos
            document.querySelectorAll('.step').forEach((stepElement, index) => {
                if (index + 1 < step) {
                    stepElement.classList.remove('active');
                    stepElement.classList.add('completed');
                } else if (index + 1 === step) {
                    stepElement.classList.add('active');
                    stepElement.classList.remove('completed');
                } else {
                    stepElement.classList.remove('active', 'completed');
                }
            });
            
            // Cargar campos din√°micos si estamos en el paso 2
            if (step === 2 && formData.userType && document.getElementById('request-type').value) {
                loadDynamicFields();
            }
            
            // Generar resumen si estamos en el paso 4
            if (step === 4) {
                generateSummary();
            }
        }

        function nextStep(current, next) {
            // Validar antes de avanzar
            if (current === 1) {
                if (!document.getElementById('user-type').value) {
                    alert('Por favor seleccione su tipo de usuario');
                    return;
                }
                if (!document.getElementById('request-type').value) {
                    alert('Por favor seleccione el tipo de solicitud');
                    return;
                }
                
                formData.userType = document.getElementById('user-type').value;
                formData.requestType = document.getElementById('request-type').value;
                
                // Guardar datos adicionales de administrativos
                if (formData.userType === 'administrative') {
                    formData.administrativeInfo = {
                        area: document.getElementById('area').value,
                        faculty: document.getElementById('faculty').value
                    };
                }
            } else if (current === 2) {
                // Validar campos personales
                if (!validatePersonalInfo()) {
                    alert('Por favor complete todos los campos requeridos');
                    return;
                }
                
                // Guardar datos personales
                formData.personalInfo = {
                    fullname: document.getElementById('fullname').value,
                    idType: document.getElementById('id-type').value,
                    idNumber: document.getElementById('id-number').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };
                
                // Guardar detalles espec√≠ficos de la solicitud
                formData.requestDetails = {};
                const dynamicFields = document.querySelectorAll('#dynamic-fields input, #dynamic-fields select, #dynamic-fields textarea');
                dynamicFields.forEach(field => {
                    if (field.type === 'checkbox') {
                        const checked = document.querySelectorAll(`input[name="${field.name}"]:checked`);
                        formData.requestDetails[field.name] = Array.from(checked).map(c => c.value);
                    } else {
                        formData.requestDetails[field.name] = field.value;
                    }
                });
            }
            
            goToStep(next);
        }

        function prevStep(current, prev) {
            goToStep(prev);
        }

        // Cargar campos din√°micos seg√∫n tipo de solicitud
        function loadDynamicFields() {
            const requestType = document.getElementById('request-type').value;
            const dynamicFieldsDiv = document.getElementById('dynamic-fields');
            let html = '<h3>Detalles de la solicitud</h3>';
            
            // Obtener campos para este tipo de solicitud o campos gen√©ricos para "Otra"
            const fields = requestFields[requestType] || requestFields["Otra"];
            
            if (fields) {
                fields.forEach(field => {
                    html += '<div class="form-group">';
                    html += `<label for="${field.name}">${field.label}${field.required ? ' *' : ''}</label>`;
                    
                    if (field.type === 'select') {
                        html += `<select id="${field.name}" name="${field.name}" class="form-control" ${field.required ? 'required' : ''}>`;
                        html += '<option value="">-- Seleccione --</option>';
                        field.options.forEach(option => {
                            html += `<option value="${option}">${option}</option>`;
                        });
                        html += '</select>';
                    } else if (field.type === 'textarea') {
                        html += `<textarea id="${field.name}" name="${field.name}" class="form-control" rows="3" ${field.required ? 'required' : ''}></textarea>`;
                    } else if (field.type === 'checkbox') {
                        field.options.forEach((option, index) => {
                            html += `<div><input type="checkbox" id="${field.name}-${index}" name="${field.name}" value="${option}">`;
                            html += `<label for="${field.name}-${index}"> ${option}</label></div>`;
                        });
                    } else {
                        html += `<input type="${field.type}" id="${field.name}" name="${field.name}" class="form-control" ${field.required ? 'required' : ''}>`;
                    }
                    
                    html += '</div>';
                });
                
                dynamicFieldsDiv.innerHTML = html;
            }
        }

        // Validar informaci√≥n personal
        function validatePersonalInfo() {
            const requiredFields = [
                'fullname', 'id-type', 'id-number', 'email', 'phone'
            ];
            
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.style.borderColor = 'red';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            return isValid;
        }

        // Manejo de archivos adjuntos
        document.getElementById('file-input').addEventListener('change', function(e) {
            const files = e.target.files;
            const fileList = document.getElementById('file-list');
            
            fileList.innerHTML = '';
            formData.documents = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                formData.documents.push(file);
                
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button onclick="removeFile(${i})"><i class="fas fa-times"></i></button>
                `;
                
                fileList.appendChild(fileItem);
            }
        });

        function removeFile(index) {
            formData.documents.splice(index, 1);
            document.getElementById('file-input').value = '';
            document.getElementById('file-list').innerHTML = '';
            
            // Volver a agregar los archivos restantes
            formData.documents.forEach((file, i) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button onclick="removeFile(${i})"><i class="fas fa-times"></i></button>
                `;
                
                document.getElementById('file-list').appendChild(fileItem);
            });
        }

        // Generar resumen de la solicitud
        function generateSummary() {
            const summaryContent = document.getElementById('summary-content');
            let html = `
                <h4>Resumen de la solicitud</h4>
                <p><strong>Tipo de usuario:</strong> ${document.getElementById('user-type').selectedOptions[0].text}</p>
                <p><strong>Tipo de solicitud:</strong> ${formData.requestType}</p>
            `;
            
            // Informaci√≥n adicional para administrativos
            if (formData.userType === 'administrative') {
                html += `
                    <p><strong>√Årea/Dependencia:</strong> ${formData.administrativeInfo.area}</p>
                    <p><strong>Facultad/Unidad:</strong> ${formData.administrativeInfo.faculty}</p>
                `;
            }
            
            // Informaci√≥n personal
            html += `
                <h5>Informaci√≥n personal</h5>
                <p><strong>Nombre completo:</strong> ${formData.personalInfo.fullname}</p>
                <p><strong>Tipo de documento:</strong> ${document.getElementById('id-type').selectedOptions[0].text}</p>
                <p><strong>N√∫mero de documento:</strong> ${formData.personalInfo.idNumber}</p>
                <p><strong>Correo electr√≥nico:</strong> ${formData.personalInfo.email}</p>
                <p><strong>Tel√©fono de contacto:</strong> ${formData.personalInfo.phone}</p>
            `;
            
            // Detalles de la solicitud
            html += `<h5>Detalles de la solicitud</h5>`;
            for (const [key, value] of Object.entries(formData.requestDetails)) {
                if (Array.isArray(value)) {
                    html += `<p><strong>${key}:</strong> ${value.join(', ')}</p>`;
                } else {
                    html += `<p><strong>${key}:</strong> ${value}</p>`;
                }
            }
            
            // Documentos adjuntos
            html += `<h5>Documentos adjuntos</h5>`;
            if (formData.documents.length > 0) {
                formData.documents.forEach(file => {
                    html += `<p>${file.name} (${(file.size / 1024).toFixed(1)} KB)</p>`;
                });
            } else {
                html += `<p>Ning√∫n documento adjunto</p>`;
            }
            
            summaryContent.innerHTML = html;
        }

        // Enviar la solicitud
        function submitRequest() {
            // Generar ticket
            formData.ticket = 'CC-' + new Date().getFullYear() + '-' + Math.floor(1000 + Math.random() * 9000);

            // Crear FormData para enviar todo correctamente (incluyendo archivos)
            const dataToSend = new FormData();

            // Campos simples
            dataToSend.append('userType', formData.userType);
            dataToSend.append('requestType', formData.requestType);
            dataToSend.append('fullname', formData.personalInfo.fullname);
            dataToSend.append('idType', formData.personalInfo.idType);
            dataToSend.append('idNumber', formData.personalInfo.idNumber);
            dataToSend.append('email', formData.personalInfo.email);
            dataToSend.append('phone', formData.personalInfo.phone);
            dataToSend.append('requestDetails', JSON.stringify(formData.requestDetails));
            dataToSend.append('ticket', formData.ticket);

            // Archivos (formData.documents es un array de File)
            if (formData.documents && formData.documents.length > 0) {
                formData.documents.forEach((file, index) => {
                    dataToSend.append('documents[]', file);
                });
            }

            fetch('../controladores/enviarFormulario.php', {
                method: 'POST',
                body: dataToSend
            })
            .then(response => response.json())
            .then(data => {
                console.log("Respuesta del PHP:", data);

                if (data.success) {
                    document.getElementById('ticket-number').textContent = 'N√∫mero de ticket: ' + formData.ticket;

                    alert("Solicitud enviada correctamente. N√∫mero de ticket: " + formData.ticket);
                    goToStep(5); // Ir al paso 5
                } else {
                    alert("Error al enviar solicitud: " + data.message);
                }
            })
            .catch(error => {
                console.error("Error en la solicitud:", error);
            });
        }

        function resetAndGoHome() {
            // Reiniciar los datos del formulario (si est√°s usando formData)
            formData = {
                userType: '',
                requestType: '',
                personalInfo: {
                    fullname: '',
                    idType: '',
                    idNumber: '',
                    email: '',
                    phone: ''
                },
                requestDetails: {},
                documents: [],
                ticket: ''
            };

            // Tambi√©n puedes resetear elementos del DOM si fuera necesario
            document.getElementById('ticket-number').innerText = '';

            // Redireccionar al inicio
            window.location.href = '/campus_connect/vistas/index.html';
        }

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Universitario</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="chatbot-button" id="chatbotButton">
        <i class="fas fa-comments"></i>
    </div>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            Asistente Universitario
        </div>
        <div class="chatbot-body" id="chatbotBody"></div>
        <div class="chatbot-footer">
            <input type="text" id="userInput" placeholder="Escribe tu mensaje..." autocomplete="off">
        </div>
    </div>

    <script>
        const chatbotButton = document.getElementById('chatbotButton');
        const chatbotContainer = document.getElementById('chatbotContainer');
        const chatbotBody = document.getElementById('chatbotBody');
        const userInput = document.getElementById('userInput');
        
        // Mostrar/ocultar chatbot
        chatbotButton.addEventListener('click', () => {
            chatbotContainer.style.display = chatbotContainer.style.display === 'flex' ? 'none' : 'flex';
            if (chatbotContainer.style.display === 'flex') {
                showMainMenu();
            }
        });
        
        // Manejar entrada del usuario
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && userInput.value.trim() !== '') {
                addUserMessage(userInput.value.trim());
                handleUserInput(userInput.value.trim());
                userInput.value = '';
            }
        });
        
        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.textContent = text;
            chatbotBody.appendChild(messageDiv);
            chatbotBody.scrollTop = chatbotBody.scrollHeight;
        }
        
        function addBotMessage(text, isHTML = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            if (isHTML) {
                messageDiv.innerHTML = text;
            } else {
                messageDiv.textContent = text;
            }
            chatbotBody.appendChild(messageDiv);
            chatbotBody.scrollTop = chatbotBody.scrollHeight;
        }

        document.addEventListener('click', function(event) {
            const chatbot = document.getElementById('chatbotContainer');
            const button = document.getElementById('chatbotButton');

            if (chatbot.style.display === 'flex' &&
                !chatbot.contains(event.target) &&
                !button.contains(event.target)) {
                chatbot.style.display = 'none';
            }
        });
        
        function showMainMenu() {
            addBotMessage(`
                <strong>Men√∫ Principal</strong>
                <div class="menu-option" onclick="selectOption(1)"><i class="fas fa-paper-plane icon"></i> Enviar Solicitud</div>
                <div class="menu-option" onclick="selectOption(2)"><i class="fas fa-search icon"></i> Consultar Estado</div>
                <div class="menu-option" onclick="selectOption(3)"><i class="fas fa-question-circle icon"></i> Preguntas Frecuentes</div>
                <div class="menu-option" onclick="selectOption(4)"><i class="fas fa-headset icon"></i> Contactar Asesor</div>
            `, true);
        }
        
        function selectOption(option) {
            addUserMessage(['Enviar Solicitud', 'Consultar Estado', 'Preguntas Frecuentes', 'Contactar Asesor'][option-1]);
            
            if (option === 1) {
                window.location.href = '/campus_connect/vistas/enviar_solicitud.html';
            } else if (option === 2) {
                window.location.href = '/campus_connect/vistas/estado_solicitud.html';
            } else if (option === 3) {
                showFAQ();
            } else {
                showContactForm();
            }
        }
        
        function showFAQ() {
            addBotMessage(`
                <strong>¬øSobre qu√© tipo deseas ver preguntas frecuentes?</strong>
                <div class="menu-option" onclick="showFAQByUserType('aspirante')">üë®‚Äçüéì Aspirante</div>
                <div class="menu-option" onclick="showFAQByUserType('estudiante')">üìö Estudiante</div>
                <div class="menu-option" onclick="showFAQByUserType('egresado')">üéì Egresado</div>
                <div class="menu-option" onclick="showFAQByUserType('profesor')">üë©‚Äçüè´ Profesor</div>
                <div class="menu-option" onclick="showFAQByUserType('contratista')">üîß Contratista</div>
                <div class="menu-option" onclick="showFAQByUserType('externo')">üåê Persona externa</div>
            `, true);
        }

        function showFAQByUserType(tipo) {
            addUserMessage(tipo.charAt(0).toUpperCase() + tipo.slice(1));
            
            const preguntas = {
                aspirante: [
                    { id: 'asp_requisitos', texto: '¬øCu√°les son los requisitos para inscribirme?' },
                    { id: 'asp_programas', texto: '¬øQu√© programas acad√©micos ofrecen?' }
                ],
                estudiante: [
                    { id: 'est_consulta', texto: '¬øC√≥mo consultar informaci√≥n b√°sica de mi inter√©s?' }
                ],
                egresado: [
                    { id: 'egr_acta', texto: '¬øC√≥mo puedo obtener mi acta o diploma si no lo he reclamado?' },
                    { id: 'egr_bolsa', texto: '¬øLa universidad ofrece bolsa de empleo para egresados?' },
                    { id: 'egr_correo', texto: '¬øPuedo seguir usando el correo institucional como egresado?' }
                ],
                profesor: [
                    { id: 'prof_notas', texto: '¬øC√≥mo ingreso al sistema para cargar notas?' },
                    { id: 'prof_usuario', texto: '¬øQu√© hago si tengo inconvenientes con mi usuario institucional?' },
                    { id: 'prof_electivas', texto: '¬øPuedo proponer nuevas electivas o ajustes al plan de estudio?' }
                ],
                contratista: [
                    { id: 'cont_ingreso', texto: '¬øC√≥mo ingreso a las instalaciones con mi carn√© temporal?' },
                    { id: 'cont_permiso', texto: '¬øD√≥nde solicito un permiso para realizar actividades dentro del campus?' },
                    { id: 'cont_servicios', texto: '¬øPuedo acceder al comedor universitario o zonas comunes?' }
                ],
                externo: [
                    { id: 'ext_biblioteca', texto: '¬øPuedo acceder a la biblioteca como visitante?' },
                    { id: 'ext_diplomados', texto: '¬øLa universidad ofrece cursos o diplomados abiertos al p√∫blico?' },
                    { id: 'ext_alquiler', texto: '¬øC√≥mo puedo alquilar un auditorio o espacio dentro del campus?' }
                ]
            };

            if (preguntas[tipo]) {
                let html = `<strong>Preguntas para ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</strong>`;
                preguntas[tipo].forEach(p => {
                    html += `<div class="menu-option" onclick="showFAQAnswer('${p.id}')">${p.texto}</div>`;
                });
                html += `<div class="menu-option" onclick="showFAQ()">‚¨Ö Volver al men√∫ anterior</div>`;
                addBotMessage(html, true);
            } else {
                addBotMessage('No hay preguntas frecuentes disponibles para este tipo de usuario.');
            }
        }

        
        function showFAQAnswer(questionKey) {
            const answers = {
                // Aspirantes
                'asp_requisitos': `
                    Debes diligenciar el formulario de inscripci√≥n en el portal de la Universidad de Medell√≠n, subir documentos como:<br>
                    - C√©dula<br>
                    - Acta o diploma de bachiller<br>
                    - Resultados Saber 11<br>
                    Luego podr√°s consultar la entrevista, presentar prueba diagn√≥stica (obligatoria), pagar matr√≠cula y asistir a inducci√≥n.
                `,
                'asp_programas': `
                    <strong>Pregrados:</strong> Ingenier√≠as, Econom√≠a, Psicolog√≠a, Comunicaci√≥n, Derecho, etc.<br>
                    <strong>Especializaciones:</strong> Derecho, Ciencia de Datos, etc.<br>
                    <strong>Maestr√≠as:</strong> Finanzas, Ingenier√≠a, Derecho Penal, Educaci√≥n, etc.<br>
                    <strong>Doctorados:</strong> Derecho, Comunicaci√≥n, Ingenier√≠a, Educaci√≥n, Administraci√≥n y Ciencias Sociales.
                `,

                // Estudiantes
                'est_consulta': `
                    Inicia sesi√≥n en la plataforma "Consultas y Servicios Acad√©micos". Puedes consultar:<br>
                    - Horarios<br>
                    - Notas<br>
                    - Certificados<br>
                    - Historial acad√©mico<br>
                    Usuario: tu c√©dula<br>
                    Contrase√±a: tu fecha de nacimiento (sin puntos ni comas).
                `,

                // Egresados
                'egr_acta': 'Debes ir a la Oficina de Registro con tu documento de identidad. Tambi√©n puedes contactarlos por correo para alternativas.',
                'egr_bolsa': 'S√≠. Usa tu c√©dula y correo institucional para acceder a la plataforma de empleabilidad del Centro de Extensi√≥n de Graduados.',
                'egr_correo': 'S√≠, el correo institucional permanece activo aunque puede tener algunas restricciones.',

                // Profesores
                'prof_notas': 'Ingresa al sistema acad√©mico con tu usuario y contrase√±a institucional para registrar calificaciones.',
                'prof_usuario': 'Contacta al √°rea de soporte t√©cnico o servicios inform√°ticos para restablecer el acceso.',
                'prof_electivas': 'Puedes proponer nuevas electivas o ajustes en el plan de estudio al Consejo de Facultad, siguiendo los lineamientos del comit√© curricular.',

                // Contratistas
                'cont_ingreso': 'Debes registrarte con el √°rea de Seguridad y presentar tu carn√© temporal en la porter√≠a.',
                'cont_permiso': 'El permiso se solicita a trav√©s de la unidad que te contrat√≥ y debe validarse con Seguridad.',
                'cont_servicios': 'Algunos contratistas pueden acceder al comedor o zonas comunes seg√∫n su contrato. Confirma con Recursos Humanos.',

                // Externos
                'ext_biblioteca': 'El acceso suele estar restringido. Puedes consultar si existen convenios o permisos especiales.',
                'ext_diplomados': 'S√≠, hay diplomados y cursos abiertos al p√∫blico. Consulta la oferta acad√©mica en la web oficial.',
                'ext_alquiler': 'Contacta a la Oficina de Eventos o Log√≠stica Institucional para solicitar espacios como auditorios. Ellos te informar√°n tarifas y requisitos.'
            };

            const question = document.querySelector(`.menu-option[onclick="showFAQAnswer('${questionKey}')"]`);
            if (question) addUserMessage(question.innerText);
            
            addBotMessage(answers[questionKey]);
            setTimeout(showFAQ, 4000);
        }

        
        function showContactForm() {
            addBotMessage(`
                Un asesor se comunicar√° contigo pronto. ¬øCu√°l es tu n√∫mero de tel√©fono?
            `);
        }
        
        function handleUserInput(input) {
            if (input.toLowerCase().includes('tel√©fono') || input.toLowerCase().includes('telefono') || input.toLowerCase().includes('contacto')) {
                addBotMessage("Gracias. Un asesor te contactar√° en las pr√≥ximas 24 horas.");
                setTimeout(showMainMenu, 1500);
            } else if (/^\d+$/.test(input)) {
                addBotMessage(`Consulta recibida para el n√∫mero ${input}. Te responderemos pronto.`);
                setTimeout(showMainMenu, 1500);
            } else {
                addBotMessage("No entend√≠ tu mensaje. Por favor selecciona una opci√≥n del men√∫.");
                setTimeout(showMainMenu, 1500);
            }
        }
        
        // Hacer funciones accesibles globalmente
        window.selectOption = selectOption;
        window.selectUserType = selectUserType;
        window.showFAQAnswer = showFAQAnswer;
    </script>
</body>
</html>